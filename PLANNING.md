# PLANNING.md

# üîÆ –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–∞ ¬´Market Genius¬ª

_(–ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-05-20)_

## 1. –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞

1.  –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞–¥—ë–∂–Ω—É—é –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—É—é —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∞–∫—Ü–∏–π –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏ —Å –≥–æ—Ä–∏–∑–æ–Ω—Ç–æ–º **1-180 –¥–Ω–µ–π**.
2.  –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä—è–µ–º—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –¥–æ–ø—É—Å–∫–∞—é—â—É—é –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö (–Ω–æ–≤—ã–µ API, CSV-—Ñ–∏–¥—ã, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö).
3.  –û–±–µ—Å–ø–µ—á–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ, –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ **–µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ**, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–æ–≤ / –º–µ—Ç—Ä–∏–∫.
4.  –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å REST / CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã.

## 2. –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∫–æ–¥–∞

```
src/
‚îú‚îÄ‚îÄ data_ingestion/        # –ó–∞–≥—Ä—É–∑–∫–∞ —Å—ã—Ä–æ–≤—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ –∏ –º–∞–∫—Ä–æ-–ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ etl/                   # –ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä Telegram-–Ω–æ–≤–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ utils/                 # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã (GPT –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä, —á–∏—Å—Ç–∫–∞ —Ç–∏–∫–µ—Ä–æ–≤)
‚îú‚îÄ‚îÄ data_processing_temp/  # –í—Ä–µ–º–µ–Ω–Ω—ã–µ standalone-—Å–∫—Ä–∏–ø—Ç—ã (–ø–æ–¥–ª–µ–∂–∞—Ç –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—é)
‚îî‚îÄ‚îÄ ‚Ä¶ 
```

+ –ó–∞–≥—Ä—É–∑–∫–∞ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç, –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏, —Ü–µ–Ω –Ω–µ—Ñ—Ç–∏ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `data_ingestion/`.
+ ETL-–ø–∞–π–ø–ª–∞–π–Ω –Ω–æ–≤–æ—Å—Ç–µ–π Telegram —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ **7 –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —à–∞–≥–æ–≤** (`00_telegram_parser.py` ‚Ä¶ `06_process_batch_results.py`) –∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ `update_pipeline.py`.
+ –ê–Ω–∞–ª–∏–∑ –Ω–æ–≤–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ OpenAI GPT –≤—ã–Ω–µ—Å–µ–Ω –≤ `utils/gpt_analyzer.py`, —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Ç–µ—Å–Ω–æ —Å–≤—è–∑–∞–Ω —Å –∫–æ–Ω—Ñ–∏–≥-JSON –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–±–∏—Ç –Ω–∞ –ø–æ–¥-–º–æ–¥—É–ª–∏.

## 3. –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 3.1 –°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö

1. **Raw Zone** (`data/raw`, `data/external`)  ‚Äì –Ω–µ–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –≤—ã–≥—Ä—É–∑–∫–∏ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
2. **Staging Zone** (`data/processed/staging`) ‚Äì –æ—á–∏—â–µ–Ω–Ω—ã–µ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –≥–æ—Ç–æ–≤—ã–µ –∫ —Ñ–∏—á–µ—Ä–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥—É.
3. **Feature Store** (`data/processed/features`) ‚Äì –∏—Ç–æ–≥–æ–≤—ã–µ —Ñ–∏—á–∏ –¥–ª—è –º–æ–¥–µ–ª–µ–π ML.
4. **Model Artifacts** (`artifacts/models`, `artifacts/metrics`) ‚Äì –≤–µ—Å–∞ –º–æ–¥–µ–ª–µ–π, pickle/onnx, –æ—Ç—á—ë—Ç—ã
5. **Logs & Monitoring** (`logs/`, Prometheus + Grafana, optional)

### 3.2 –ö–æ–¥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
src/
‚îú‚îÄ‚îÄ ingestion/           # <‚Äî –ù–û–í–û–ï –∏–º—è, –≤–º–µ—â–∞–µ—Ç data_ingestion/*
‚îÇ   ‚îî‚îÄ‚îÄ loaders/{moex, cbr, ‚Ä¶}.py
‚îú‚îÄ‚îÄ pipelines/           # –ü–∞–π–ø–ª–∞–π–Ω—ã, orchestration (Airflow/Dagster Prefect)
‚îÇ   ‚îú‚îÄ‚îÄ telegram_news.py
‚îÇ   ‚îî‚îÄ‚îÄ macro_update.py
‚îú‚îÄ‚îÄ features/            # Feature engineering (—Ç–µ—Ö. –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã, NLP, ‚Ä¶)
‚îú‚îÄ‚îÄ models/              # –û–±—É—á–µ–Ω–∏–µ, –∏–Ω—Ñ–µ—Ä–µ–Ω—Å, backtesting
‚îú‚îÄ‚îÄ services/            # FastAPI —Å–µ—Ä–≤–∏—Å—ã, CLI, gRPC
‚îú‚îÄ‚îÄ core/                # –û–±—â–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏: configs, io, utils, logging
‚îî‚îÄ‚îÄ tests/
```

*–ü–∞–ø–∫–∏ `feature_engineering/`, `models/` –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–ø–æ –ø–µ—Ä–µ–µ–¥—É—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∏.*

### 3.3 –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –°–ª–æ–π                | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã/–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ |
|---------------------|-------------------------|
| ETL / Orchestration | Airflow |
| –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö     | Parquet + DuckDB \| Postgres |
| ML/TS –º–æ–¥–µ–ª–∏        | scikit-learn, pytorch, lightgbm |
| NLP                 | openai API |
| API-—Å–ª–æ–π            | FastAPI + Uvicorn |
| User Interaction    | Telegram Bot API (aiogram) |
| CI/CD               | GitHub Actions, Docker, (Docker Compose / Kubernetes) |

## 4. –ö–æ–¥-—Å—Ç–∞–π–ª –∏ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **PEP-8 + Black** (line-length = 120).  –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –±—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω `pre-commit`:
   * `black`, `isort`, `flake8`, `mypy`, `pytest`.
2. **–¢–∏–ø–∏–∑–∞—Ü–∏—è**: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ `typing` –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ + `mypy --strict` –≤ CI.
3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: docstring —Ñ–æ—Ä–º–∞—Ç–∞ **Google** –∏–ª–∏ **Numpy**; –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è `docs/` —á–µ—Ä–µ–∑ Sphinx + Napoleon.
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `logging` —Å YAML-–∫–æ–Ω—Ñ–∏–≥–æ–º –≤ `configs/logging.yaml`, —Ñ–æ—Ä–º–∞—Ç json-line –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.
5. **–¢–µ—Å—Ç—ã**: `pytest` + `pytest-cov`, —Ü–µ–ª–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–∫—Ä—ã—Ç–∏—è ‚â• 80 % –¥–ª—è core-–ª–æ–≥–∏–∫–∏.
6. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: Pydantic v2 `BaseSettings`; `.env` –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤; –≤—Å–µ –ø—É—Ç–∏/–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ YAML/ENV, –Ω–µ ¬´–º–∞–≥–∏—á–µ—Å–∫–∏–º–∏¬ª –ª–∏—Ç–µ—Ä–∞–ª–∞–º–∏.
7. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö/–º–æ–¥–µ–ª–µ–π**: DVC –∏–ª–∏ MLflow;
8. **–°–µ–∫—å—é—Ä–∏—Ç–∏**: —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π API-–∫–ª—é—á–µ–π;
9. **–ß–∏—Å—Ç–æ—Ç–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: `poetry` –∏–ª–∏ `pip-tools` —Å `requirements.txt` + dependabot.

## 5. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –¥–æ–ø—É—â–µ–Ω–∏—è

* **–î–∞–Ω–Ω—ã–µ Telegram** –º–æ–≥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –¥–ª—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞—Ç ‚Üí backfill –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ ¬´–ª—É—á—à–µ–π –ø–æ–ø—ã—Ç–∫–µ¬ª; –º–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ —É–º–µ—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –±–µ–∑ –Ω–∏—Ö.
* **Rate-Limit** API (–¶–ë –†–§, MOEX, OpenAI).  –î–æ—Å—Ç—É–ø –∫ OpenAI —Ç–∞—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è ‚Äì –∫–æ–ª-–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –≤ `configs/llm.yaml`.
* **–ó–∞–ø—É—Å–∫ Windows**: —Å–∫—Ä–∏–ø—Ç—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ, –Ω–æ heavy-ML –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤ Linux-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.
* **–ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã**: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Äì CPU 16 GB RAM; GPU –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (pytorch fallback –Ω–∞ CPU).
* **–õ–∏—Ü–µ–Ω–∑–∏—è**: MIT (–µ—Å–ª–∏ –∏–Ω–æ–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ).  –î–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å–æ–±–ª—é–¥–∞–µ–º –ª–∏—Ü–µ–Ω–∑–∏–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤.

## 6. –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (MVP ‚Üí v1)

| Sprint | –¶–µ–ª—å | –í—ã—Ö–æ–¥ | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π |
|--------|------|-------|---------------|
| S-1 | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD, pre-commit, Black + isort | –∑–µ–ª—ë–Ω—ã–π pipeline | @dev |
| S-2 | –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ `data_ingestion/*` ‚Üí `ingestion/`, —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `BaseLoader` | –º–æ–¥—É–ª—å `ingestion` | |
| S-3 | –†–∞–∑–¥–µ–ª–∏—Ç—å ETL-—Å–∫—Ä–∏–ø—Ç—ã Telegram –Ω–∞ –∫–ª–∞—Å—Å—ã + Prefect flow | `pipelines/telegram_news.py` | |
| S-4 | –ë–∞–∑–æ–≤—ã–π feature store –∏ –ø–µ—Ä–≤—ã–π ML-–±–∞–∑–ª–∞–π–Ω (LightGBM) | –Ω–æ—É—Ç–±—É–∫ + `models/baseline.py` | |
| S-5 | –°–æ–∑–¥–∞—Ç—å FastAPI endpoint `/predict` + docker-compose | –æ–±—Ä–∞–∑ `market-genius-api` | |
| S-6 | –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Telegram Publisher + Query Bot | –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã `mg-telegram-pub`, `mg-telegram-bot` | |

## 7. –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

1. **MAPE ‚â§ 5 %** –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –ø–µ—Ä–∏–æ–¥–µ 2023-2024.
2. –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–Ω–µ–≤–Ω–æ–≥–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞ ‚â§ 30 –º–∏–Ω.
3. –ü–æ–∫—Ä—ã—Ç–∏–µ unit-—Ç–µ—Å—Ç–∞–º–∏ 80 % + 0 Critical/Security Issues (Bandit).
4. End-to-end latency REST –∑–∞–ø—Ä–æ—Å–∞ `/predict` ‚â§ 200 –º—Å.

---

_–î–æ–∫—É–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è –∂–∏–≤—ã–º._